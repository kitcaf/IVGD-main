# IVGD项目输入数据格式分析

## 概述

本项目的输入数据文件采用Python pickle格式存储（`.SG`后缀），包含了图结构数据和影响力传播模拟结果。数据文件存储在`data/`目录下，命名格式为`{数据集名称}_25c.SG`。

## 数据文件格式

### 文件类型
- **格式**: Python Pickle格式（二进制序列化）
- **扩展名**: `.SG` (SparseGraph)
- **加载方式**: 使用`pickle.load()`加载
- **数据类**: `SparseGraph`类对象（定义在`data/sparsegraph.py`中）

### 可用数据集
项目中包含以下数据集：
- `karate_25c.SG` - 空手道俱乐部网络 (34个节点)
- `dolphins_25c.SG` - 海豚社交网络
- `jazz_25c.SG` - 爵士音乐家合作网络
- `netscience_25c.SG` - 科学家合作网络
- `cora_ml_25c.SG` - Cora引文网络
- `power_grid_25c.SG` - 电网网络

## 数据结构详解

### 1. SparseGraph对象

`SparseGraph`是一个自定义的图数据结构类，主要包含以下三个核心属性：

#### 1.1 邻接矩阵 (adj_matrix)
数据预处理阶段就生成的
**作用**: 表示图的拓扑结构，描述节点之间的连接关系

**数据结构**:
```
类型: scipy.sparse.csr_matrix (压缩稀疏行矩阵)
形状: (N, N)，其中N是节点数量
数据类型: float32
含义: adj_matrix[i, j] = 1 表示节点i和节点j之间存在边
```

#### 1.2 概率矩阵 (prob_matrix)

**作用**: 表示影响力在网络中传播的概率，即节点之间的影响传播强度

**数据结构**:
```
类型: scipy.sparse.csr_matrix (压缩稀疏行矩阵)
形状: (N, N)，其中N是节点数量
数据类型: float64
含义: prob_matrix[i, j] 表示节点i影响节点j的概率
值范围: (0, 1]之间的浮点数
```

**示例 (karate数据集)**:
```
- 形状: (34, 34)
- 非零元素: 156个（与邻接矩阵对应）
- 值范围: [0.0003, 0.1479]
- 唯一值数量: 148个（几乎每条边都不同）
- 均值: 0.0739，标准差: 0.0410
```

**初始化方式**:
- **随机生成**: 概率矩阵在数据预处理阶段通过随机数生成器初始化
- **采样范围**: 每条边的激活概率在 [0.0001, 0.15] 区间内独立随机采样
- **理论模型**: 基于Independent Cascade (IC) 模型，每条边有固定的独立激活概率
- **验证结果**:
  - ✗ 不是基于度数公式（如 1/degree）
  - ✗ 不是归一化的（入边概率和不等于1）
  - ✗ 与节点度数无显著相关性（相关系数 ≈ 0.006）

**核心作用**:

1. **影响力传播模拟** (数据生成阶段):
   - 用于生成 `influ_mat_list` 数据
   - 在Independent Cascade模型中，当节点i在t时刻被激活时，它在t+1时刻有 prob_matrix[i,j] 的概率激活邻居节点j
   - 模拟了真实社交网络中影响力传播的随机性和异质性
   
2. **图结构先验信息** (模型训练阶段):
   - 作为GCN/图神经网络的输入，提供图的拓扑和权重信息
   - 在 `i_DeepIS` 模型中，通过 `DiffusionPropagate` 类进行迭代传播计算
   - 公式: `H^(t+1) = σ(prob_matrix · H^(t) · W)`
   - 帮助模型学习影响力在网络中的扩散模式


#### 1.3 矩阵列表 (influ_mat_list) --- 传播数据

**作用**: 存储多个影响力传播实例的完整时间序列数据，用于训练和测试模型

**数据结构**:
```
类型: numpy.ndarray (三维数组)
形状: (M, N, T)
  - M: 样本数量（不同的影响力传播实例）
  - N: 节点数量
  - T: 时间步数（影响力扩散的迭代步数）
数据类型: float64
值: 0或1（二值化的影响状态）
```

**示例 (karate数据集)**:
```
- 形状: (60, 34, 25)
  - 60个不同的影响力传播实例
  - 34个节点
  - 25个时间步
```

**详细说明**:

##### 维度1：样本维度 (M=60)
- 表示60个不同的影响力传播模拟实例
- 每个实例有不同的初始种子节点集合
- 用于训练和测试模型的泛化能力

##### 维度2：节点维度 (N=34)
- 表示图中的所有节点
- 每个节点在每个时间步都有一个影响状态值

##### 维度3：时间维度 (T=25)
- 表示影响力扩散过程的25个时间步
- **第0列 (t=0)**: 初始种子节点集合
  - 值为1表示该节点是种子节点
  - 值为0表示该节点不是种子节点
- **第1列至第23列 (t=1 to t=23)**: 中间扩散过程
  - 记录影响力在网络中逐步传播的过程
  - 每个时间步，被影响的节点状态从0变为1
- **第24列 (t=24, 最后一列)**: 最终影响范围
  - 表示影响力传播达到稳定状态后的结果
  - 值为1表示该节点最终被影响
  - 值为0表示该节点未被影响

**数据示例**:
```python
# 第一个样本 influ_mat_list[0] 的形状为 (34, 25)
# 初始种子节点（第0列）：7个节点的值为1
# 最终影响范围（第24列）：7个节点的值为1（在这个例子中，影响未扩散）

# 典型的数据访问方式：
sample_i = influ_mat_list[i]           # 获取第i个样本
seed_vec = sample_i[:, 0]              # 初始种子节点向量（N,）
influ_vec = sample_i[:, -1]            # 最终影响范围向量（N,）
process = sample_i[:, 1:-1]            # 中间传播过程（N, 23）
```

## 数据使用流程

### 1. 数据加载
```python
from main.utils import load_dataset

# 加载数据集
graph = load_dataset('karate')  # 加载karate数据集

# 访问数据
adj_matrix = graph.adj_matrix          # 邻接矩阵
prob_matrix = graph.prob_matrix        # 概率矩阵
influ_mat_list = graph.influ_mat_list  # 影响力矩阵列表
```

### 2. 训练数据划分
```python
# 划分训练集和测试集（80%训练，20%测试）
num_training = int(len(graph.influ_mat_list) * 0.8)
train_data = graph.influ_mat_list[:num_training]
test_data = graph.influ_mat_list[num_training:]
```

### 3. 单个样本的使用
```python
# 遍历所有样本
for i, influ_mat in enumerate(graph.influ_mat_list):
    # influ_mat 形状: (N, 25)
    seed_vec = influ_mat[:, 0]    # 初始种子节点 (N,)
    influ_vec = influ_mat[:, -1]  # 最终影响范围 (N,)
    
    # 训练任务：
    # 输入：influ_vec（观测到的影响范围）
    # 输出：seed_vec（需要预测的种子节点）
```
